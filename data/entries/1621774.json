{"forks":[],"html_url":"https://gist.github.com/1621774","url":"https://api.github.com/gists/1621774","created_at":"2012-01-16T16:56:27Z","description":"dumpGlobalLeaks in 140byt.es","public":true,"git_pull_url":"git://gist.github.com/1621774.git","files":{"annotated.js":{"type":"application/javascript","content":"function(a, b, c, d)                       //`window` (or something else) and three dummy arguments\n{\n  d = a[b = 'Leak:'                        //collect all info in string `b`\n    ] = a[b] || { };                       //initialize the list of known properties, use `Leak:` as name\n  for (c in a)                             //check everything in the `window` object\n    try                                    //not required in Opera, but Firefox crashs for `sessionStorage`\n    {\n      d[c] ||                              //if this property is known from the previous call or\n      /\\[native code]/.exec(a[c])          //if this is a native function\n        ? 1                                //then do nothing\n        : b += '\\n' + c + ' = ' + a[c],    //else add name and value to the string\n      d[c] = 1                             //add this property to the list of known properties\n    }\n    catch (e) { }\n  return b                                 //return the string\n}","raw_url":"https://gist.github.com/raw/1621774/f9e0fd64f5016104d0f2b8770cd63ab736ac4758/annotated.js","size":981,"filename":"annotated.js","language":"JavaScript"},"LICENSE.txt":{"type":"text/plain","content":"            DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE\n                    Version 2, December 2004\n\n Copyright (C) 2012 Thiemo Mättig <http://maettig.com>\n\n Everyone is permitted to copy and distribute verbatim or modified\n copies of this license document, and changing it is allowed as long\n as the name is changed.\n\n            DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE\n   TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION\n\n  0. You just DO WHAT THE FUCK YOU WANT TO.","raw_url":"https://gist.github.com/raw/1621774/a6d76e1bae288ac7eb279b32326e6c03ec31ad24/LICENSE.txt","size":488,"filename":"LICENSE.txt","language":"Text"},"README.md":{"type":"text/plain","content":"Clean JavaScript code does not leak into the global variable scope. That's why we use strange looking stuff like `(function() { var a = 'I am local'; })();` to execute code in a local scope. Inside such scopes, we can declare and use variables without conflict.\n\nSince you often don't get a warning when using undeclared variables, I wrote an [140byt.es](http://140byt.es/) snippet to detect leaking variables. The idea is very simple and works in Opera and Firefox. Does not work in Internet Explorer.\n\nDue to a [bug in Firefox](https://bugzilla.mozilla.org/show_bug.cgi?id=480366) I had to add a try-catch block. Accessing or even checking the type of `window.sessionStorage` causes a \"not supported\" exception. It works fine without this in all other browsers. Another bug is that Firefox returns a `getInterface` method in the second call that was not there in the first call. I did not found out why this happens or how to prevent it. This is why I check for native functions. And (of course) there are problems in Internet Explorer. It does not store global variables in the `window` object so the function can't display anything. Replacing `window` with `this` does not help since it refers to the same object.\n\n[Click here to run the test script](http://maettig.com/code/javascript/dumpGlobalLeaks-in-140byt.es.html).","raw_url":"https://gist.github.com/raw/1621774/d57e0cb519897e35c00f1dd4816c5e83d9bdfa1c/README.md","size":1325,"filename":"README.md","language":"Markdown"},"index.js":{"type":"application/javascript","content":"function(a,b,c,d){d=a[b='Leak:']=a[b]||{};for(c in a)try{d[c]||/\\[native code]/.exec(a[c])?1:b+='\\n'+c+' = '+a[c],d[c]=1}catch(e){}return b}","raw_url":"https://gist.github.com/raw/1621774/6bfc1682d06da4726c92398bae869416f4744429/index.js","size":140,"filename":"index.js","language":"JavaScript"},"test.html":{"type":"text/html","content":"<!DOCTYPE html>\n<script type=\"text/javascript\">\n// 140 bytes\nvar dumpGlobalLeaks = function(a, b, c, d) //`window` (or something else) and three dummy arguments\n{\n  d = a[b = 'Leak:'                        //collect all info in string `b`\n    ] = a[b] || { };                       //initialize the list of known properties, use `Leak:` as name\n  for (c in a)                             //check everything in the `window` object\n    try                                    //not required in Opera, but Firefox crashs for `sessionStorage`\n    {\n      d[c] ||                              //if this property is known from the previous call or\n      /\\[native code]/.exec(a[c])          //if this is a native function\n        ? 1                                //then do nothing\n        : b += '\\n' + c + ' = ' + a[c],    //else add name and value to the string\n      d[c] = 1                             //add this property to the list of known properties\n    }\n    catch (e) { }\n  return b                                 //return the string\n}\nvar goodFunction = function(a)             //`a` is an unused argument, it's declared but not initialized\n{\n  a = 1;                                   //initialize `a`\n  var b;                                   //declare `b`\n  b = 2;                                   //initialize `b`\n  var c = 3;                               //declare and initialize `c` in a single statement\n}\nvar badFunction = function()\n{\n  a = 1;                                   //leaks to the global scope since it's undeclared in the function\n}\ndumpGlobalLeaks(window);                   //first call returns everything, this should be ignored\ngoodFunction();                            //call the non-leaking function\nalert(dumpGlobalLeaks(window));            //should display an empty leak dump\nbadFunction();                             //call the leaking function\nalert(dumpGlobalLeaks(window));            //should display a leak dump with `number a = 1`\n</script>","raw_url":"https://gist.github.com/raw/1621774/37a3fb1d46e2bc1fe5d813b654d11e5e4103dae1/test.html","size":1991,"filename":"test.html","language":"HTML"},"package.json":{"type":"application/json","content":"{\n  \"name\": \"dumpGlobalLeaks\",\n\n  \"description\": \"Debugging helper dumps all variables that leaked into the global scope.\",\n\n  \"keywords\": [\n    \"debugging\",\n    \"global\",\n    \"scope\",\n    \"test\",\n    \"variables\",\n  ]\n}","raw_url":"https://gist.github.com/raw/1621774/b58ca44fb7b48b3c31f68fbe3df707060824c82e/package.json","size":219,"filename":"package.json","language":"JSON"}},"git_push_url":"git@gist.github.com:1621774.git","fork_of":{"html_url":"https://gist.github.com/962807","url":"https://api.github.com/gists/962807","created_at":"2011-05-09T16:13:35Z","description":"140byt.es -- Click ↑↑ fork ↑↑ to play!","public":true,"git_pull_url":"git://gist.github.com/962807.git","files":{"annotated.js":{"type":"application/javascript","raw_url":"https://gist.github.com/raw/962807/cd5c9947f41abdfd608a8995e02ba4a160bb2a08/annotated.js","size":396,"filename":"annotated.js","language":"JavaScript"},"LICENSE.txt":{"type":"text/plain","raw_url":"https://gist.github.com/raw/962807/dfb480a5038214d152544bddb412dfe2e8656413/LICENSE.txt","size":483,"filename":"LICENSE.txt","language":"Text"},"README.md":{"type":"text/plain","raw_url":"https://gist.github.com/raw/962807/6832f0d91100cdb4373f2cfd42e12fc06532eac9/README.md","size":1457,"filename":"README.md","language":"Markdown"},"index.js":{"type":"application/javascript","raw_url":"https://gist.github.com/raw/962807/c89ef021071af3b78eea79bcf0288a6e7873a62e/index.js","size":140,"filename":"index.js","language":"JavaScript"},"test.html":{"type":"text/html","raw_url":"https://gist.github.com/raw/962807/22ac2a8244f3a1fd650faf81dfdde9cbae7453e5/test.html","size":393,"filename":"test.html","language":"HTML"},"package.json":{"type":"application/json","raw_url":"https://gist.github.com/raw/962807/323b4aaa685a2bf7b15abdeed2fe03e11d63859f/package.json","size":241,"filename":"package.json","language":"JSON"}},"git_push_url":"git@gist.github.com:962807.git","comments":51,"updated_at":"2011-05-18T12:15:41Z","id":"962807","user":{"url":"https://api.github.com/users/140bytes","login":"140bytes","gravatar_id":"53e21508b6995fa42f2e034b87daa901","avatar_url":"https://secure.gravatar.com/avatar/53e21508b6995fa42f2e034b87daa901?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png","id":777161}},"history":[{"url":"https://api.github.com/gists/1621774/4829ee0b709a11f06c95828369dd959a46688baa","committed_at":"2012-02-02T20:05:08Z","version":"4829ee0b709a11f06c95828369dd959a46688baa","change_status":{"additions":38,"deletions":35,"total":73},"user":{"url":"https://api.github.com/users/maettig","login":"maettig","gravatar_id":"c778099c2b124e5c230324df2b2336ab","avatar_url":"https://secure.gravatar.com/avatar/c778099c2b124e5c230324df2b2336ab?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png","id":1177987}},{"url":"https://api.github.com/gists/1621774/e3731e9320c2ac54bc08c239b2f598c636aed371","committed_at":"2012-01-16T17:17:50Z","version":"e3731e9320c2ac54bc08c239b2f598c636aed371","change_status":{"additions":61,"deletions":59,"total":120},"user":{"url":"https://api.github.com/users/maettig","login":"maettig","gravatar_id":"c778099c2b124e5c230324df2b2336ab","avatar_url":"https://secure.gravatar.com/avatar/c778099c2b124e5c230324df2b2336ab?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png","id":1177987}},{"url":"https://api.github.com/gists/1621774/96ff24cc4f871061134de4188fa24cf4b53d3986","committed_at":"2011-07-28T06:44:45Z","version":"96ff24cc4f871061134de4188fa24cf4b53d3986","change_status":{"additions":1,"deletions":1,"total":2},"user":{"url":"https://api.github.com/users/140bytes","login":"140bytes","gravatar_id":"53e21508b6995fa42f2e034b87daa901","avatar_url":"https://secure.gravatar.com/avatar/53e21508b6995fa42f2e034b87daa901?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png","id":777161}},{"url":"https://api.github.com/gists/1621774/1e1c7df97b55fe8f1543433a83d0e76a4a575055","committed_at":"2011-07-28T06:44:14Z","version":"1e1c7df97b55fe8f1543433a83d0e76a4a575055","change_status":{"additions":2,"deletions":2,"total":4},"user":{"url":"https://api.github.com/users/140bytes","login":"140bytes","gravatar_id":"53e21508b6995fa42f2e034b87daa901","avatar_url":"https://secure.gravatar.com/avatar/53e21508b6995fa42f2e034b87daa901?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png","id":777161}},{"url":"https://api.github.com/gists/1621774/97b4f64048ad388d12e0473b416d7e4893391f50","committed_at":"2011-06-01T13:42:07Z","version":"97b4f64048ad388d12e0473b416d7e4893391f50","change_status":{"additions":5,"deletions":7,"total":12},"user":{"url":"https://api.github.com/users/140bytes","login":"140bytes","gravatar_id":"53e21508b6995fa42f2e034b87daa901","avatar_url":"https://secure.gravatar.com/avatar/53e21508b6995fa42f2e034b87daa901?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png","id":777161}},{"url":"https://api.github.com/gists/1621774/df573b0569cc36550aa73fa9244286f24823fbb9","committed_at":"2011-06-01T12:27:17Z","version":"df573b0569cc36550aa73fa9244286f24823fbb9","change_status":{"additions":1,"deletions":0,"total":1},"user":{"url":"https://api.github.com/users/140bytes","login":"140bytes","gravatar_id":"53e21508b6995fa42f2e034b87daa901","avatar_url":"https://secure.gravatar.com/avatar/53e21508b6995fa42f2e034b87daa901?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png","id":777161}},{"url":"https://api.github.com/gists/1621774/2da28b4a103c6a4ca00d4d0fa808ee258b5d6eca","committed_at":"2011-05-31T22:34:03Z","version":"2da28b4a103c6a4ca00d4d0fa808ee258b5d6eca","change_status":{"additions":1,"deletions":1,"total":2},"user":{"url":"https://api.github.com/users/140bytes","login":"140bytes","gravatar_id":"53e21508b6995fa42f2e034b87daa901","avatar_url":"https://secure.gravatar.com/avatar/53e21508b6995fa42f2e034b87daa901?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png","id":777161}},{"url":"https://api.github.com/gists/1621774/cb7ce28cbcfb095a319f290d0632332f22d90c72","committed_at":"2011-05-31T18:15:34Z","version":"cb7ce28cbcfb095a319f290d0632332f22d90c72","change_status":{"additions":13,"deletions":0,"total":13},"user":{"url":"https://api.github.com/users/140bytes","login":"140bytes","gravatar_id":"53e21508b6995fa42f2e034b87daa901","avatar_url":"https://secure.gravatar.com/avatar/53e21508b6995fa42f2e034b87daa901?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png","id":777161}},{"url":"https://api.github.com/gists/1621774/a1fcbcb83329294f8afe9b71c132790e0c1f7d8b","committed_at":"2011-05-31T18:10:31Z","version":"a1fcbcb83329294f8afe9b71c132790e0c1f7d8b","change_status":{"additions":17,"deletions":19,"total":36},"user":{"url":"https://api.github.com/users/140bytes","login":"140bytes","gravatar_id":"53e21508b6995fa42f2e034b87daa901","avatar_url":"https://secure.gravatar.com/avatar/53e21508b6995fa42f2e034b87daa901?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png","id":777161}},{"url":"https://api.github.com/gists/1621774/e69917d0323336a4cb552f60484b73c09eb538ee","committed_at":"2011-05-26T16:25:15Z","version":"e69917d0323336a4cb552f60484b73c09eb538ee","change_status":{"additions":6,"deletions":6,"total":12},"user":{"url":"https://api.github.com/users/140bytes","login":"140bytes","gravatar_id":"53e21508b6995fa42f2e034b87daa901","avatar_url":"https://secure.gravatar.com/avatar/53e21508b6995fa42f2e034b87daa901?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png","id":777161}}],"comments":14,"updated_at":"2012-01-18T19:05:50Z","id":"1621774","user":{"url":"https://api.github.com/users/maettig","login":"maettig","gravatar_id":"c778099c2b124e5c230324df2b2336ab","avatar_url":"https://secure.gravatar.com/avatar/c778099c2b124e5c230324df2b2336ab?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png","id":1177987}}